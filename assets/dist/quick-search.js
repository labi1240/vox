!function(e){"function"==typeof define&&define.amd?define("quickSearch",e):e()}(function(){"use strict";window.render_quick_search=()=>{Array.from(document.querySelectorAll(".quick-search")).forEach(e=>{var t;e.__vue_app__||((t=(e=>{let t=JSON.parse(e.closest(".elementor-widget-container").querySelector(".vxconfig").innerHTML);return Vue.createApp({el:e,mixins:[Voxel.mixins.base],data(){return{config:t,postTypes:t.post_types,activePopup:null,activeType:Object.values(t.post_types)[0],search:"",loading:!1,recent:this.getRecent(),results:{query:"",items:[]}}},created(){document.onkeydown=e=>{(e.ctrlKey||e.metaKey)&&75===e.keyCode&&(e.preventDefault(),this.activePopup=null===this.activePopup?"quick-search":null),27===e.keyCode&&(this.activePopup=null)}},methods:{viewArchive(){var e;"tabbed"===this.config.display_mode?((e=new URL(this.activeType.archive)).searchParams.set(this.activeType.filter,this.search),location.href=e.toString()):((e=new URL(this.config.single_mode.submit_to)).searchParams.set(this.config.single_mode.filter_key,this.search),location.href=e.toString())},getResults(){"tabbed"===this.config.display_mode?this.queryResults(this.activeType.results,[this.activeType]):this.queryResults(this.results,Object.values(this.postTypes))},queryResults(s,e){if(this.search.trim().length<t.keywords.minlength)s.query="",s.items=[];else if(this.search.trim()!==s.query.trim()){let t={};e.forEach(e=>{t[e.key]={filter_key:e.filter,taxonomies:e.taxonomies}}),this.loading=!0,s.query=this.search.trim(),jQuery.get(Voxel_Config.ajax_url+"&action=quick_search",{search:this.search.trim(),post_types:JSON.stringify(t)}).always(e=>{this.loading=!1,e.success?s.items=e.data:Voxel.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}},debouncedResults:Voxel.helpers.debounce(e=>e.getResults(),250),saveSearchItem(t){let e=this.getRecent();(e=e.filter(e=>e.key!==t.key)).unshift(t),e=e.slice(0,8),localStorage.setItem("voxel:recent_searches",JSON.stringify(e)),this.recent=e},saveCurrentTerm(){let e=this.getRecent();var t,s=this.search.trim();let i="keywords:"+s;"tabbed"===this.config.display_mode?(t=new URL(this.activeType.archive)).searchParams.set(this.activeType.filter,s):(t=new URL(this.config.single_mode.submit_to)).searchParams.set(this.config.single_mode.filter_key,s),(e=e.filter(e=>e.key!==i)).unshift({type:"keywords",key:i,title:s,logo:null,link:t.toString()}),e=e.slice(0,8),localStorage.setItem("voxel:recent_searches",JSON.stringify(e)),this.recent=e},clearRecents(){localStorage.setItem("voxel:recent_searches",JSON.stringify([])),this.recent=[]},clickedRecent(t){let e=this.getRecent();(e=e.filter(e=>e.key!==t.key)).unshift(t),localStorage.setItem("voxel:recent_searches",JSON.stringify(e))},getRecent(){let e=[];try{var t=JSON.parse(localStorage.getItem("voxel:recent_searches"));Array.isArray(t)&&(e=t)}catch(e){}return e}},watch:{search(){this.debouncedResults(this)}}})})(e)).component("form-group",Voxel.components.formGroup),t.mount(e))})},window.render_quick_search(),jQuery(document).on("voxel:markup-update",window.render_quick_search)});
