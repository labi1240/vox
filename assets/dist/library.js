!function(e){"function"==typeof define&&define.amd?define("library",e):e()}(function(){"use strict";jQuery(e=>{var a,t=document.getElementById("voxel-library");t&&((a=(a=>{let e=JSON.parse(a.dataset.config);return Vue.createApp({el:a,data(){return{config:e,screen:"library",export_config:{post_types:{},templates:{}},state:{export_file_name:"vx-export.zip",processing_upload:!1,processing_export:!1,processing_install:!1,processing_download:!1},install:{}}},created(){window.VXLIBRARY=this,null===e.packages.list&&this.reloadLibrary(),"success"===Voxel_Backend.getSearchParam("screen")&&(this.screen="success",Voxel_Backend.deleteSearchParam("screen"))},methods:{exportPostType(e){this.export_config.post_types[e.key]={product_types:{},taxonomies:JSON.parse(JSON.stringify(e.taxonomies)),terms:{}}},runExport(){this.state.export_file_name.endsWith(".zip")||(this.state.export_file_name+=".zip"),this.state.export_file_name.length<=4&&(this.state.export_file_name="vx-export.zip"),this.state.processing_export=!0,jQuery.get(Voxel_Config.ajax_url+"&action=backend.library.prepare_export",{export_config:JSON.stringify(this.export_config)}).always(e=>{var a,t;e.success?(a=Voxel_Config.ajax_url+"&action=backend.library.download_export&export_key="+e.export_key,(t=document.createElement("a")).href=a,t.setAttribute("download",this.state.export_file_name),document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>this.state.processing_export=!1,300)):(this.state.processing_export=!1,Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error"))})},manualImport(){this.state.processing_upload=!0;var e=new FormData,a=this.$refs.manualImport.files[0];a&&e.append("package",a),jQuery.post({url:Voxel_Config.ajax_url+"&action=backend.library.prepare_import&source=upload",data:e,contentType:!1,processData:!1}).always(e=>{this.state.processing_upload=!1,e.success?(this.screen="install",this.install.import_key=e.import_key,this.install.config=e.config):Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},runImport(){this.state.processing_install=!0,jQuery.post(Voxel_Config.ajax_url+"&action=backend.library.run_import",{import_key:this.install.import_key,config:JSON.stringify(this.install.config)}).always(e=>{this.state.processing_install=!1,e.success?jQuery.get(Voxel_Config.ajax_url+"&action=backend.library.finish_import").always(e=>{a.style.display="none",window.scrollTo(0,0),Voxel_Backend.setSearchParam("screen","success"),setTimeout(()=>location.reload(),20)}):Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},reloadLibrary(){this.config.packages.loading=!0,jQuery.post(Voxel_Config.ajax_url+"&action=backend.library.get_package_list",{force_get:"yes"}).always(e=>{this.config.packages.loading=!1,e.success?this.config.packages.list=e.data:Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},installPackage(e){this.state.processing_package=e.id,jQuery.post(Voxel_Config.ajax_url+"&action=backend.library.prepare_import",{source:"library",package_id:e.id}).always(e=>{this.state.processing_package=null,e.success?(this.screen="install",this.install.import_key=e.import_key,this.install.config=e.config):Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}}})})(t)).component("color-picker",Voxel_Backend.components.Color_Picker),a.mount(t))})});
