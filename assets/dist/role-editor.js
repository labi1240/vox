!function(e){"function"==typeof define&&define.amd?define("roleEditor",e):e()}(function(){"use strict";var i={template:"#role-field-modal-template",props:["field"],data(){return{tab:"general",conditions:[],fields:this.$root.config.registration.fields}},created(){this.conditions=this.field.conditions,this.$watch(()=>this.field["enable-conditions"],(e,t)=>{!0!==e||this.conditions.length||this.conditions.push([{source:"",type:""}])})},methods:{setProps(t){var i=this.$root.condition_types[t.type];i&&(jQuery.extend(t,i.props,{source:t.source}),Object.keys(t).forEach(e=>{"type"!==e&&void 0===i.props[e]&&delete t[e]}))},getConditionGroups(e){e=e.source.split(".");let t=e[0];var e=e[1]||null,i=this.fields.find(e=>e.key===t);return!i||"profile"!==i.source||null===(i=this.$root.supported_conditions[this.$root.fieldProp(i.key,"type")])?[]:Array.isArray(i)?this._getConditionGroups(i):"object"==typeof i&&null!==e&&Array.isArray(i[e]?.supported_conditions)?this._getConditionGroups(i[e].supported_conditions):[]},_getConditionGroups(e){let i=[];return e.forEach(t=>{var e=Object.values(this.$root.condition_types).filter(e=>e.group===t);e.length&&i.push({key:t,label:t.toUpperCase(),types:e})}),i},removeCondition(e,t,i){t.splice(e,1),0===t.length&&1<this.field.conditions.length&&this.field.conditions.splice(i,1)},getSubFields(e){e=this.$root.supported_conditions[this.$root.fieldProp(e.key,"type")];return"object"!=typeof e||Array.isArray(e)||null===e?null:e},hasConditions(e){return Array.isArray(this.$root.supported_conditions[this.$root.fieldProp(e.key,"type")])}}},o={template:`
		<input type="text" readonly :value="modelValue" @click="edit">
	`,props:["modelValue","tagGroups"],data(){return{previewMarkup:""}},methods:{edit(){var t={};Array.isArray(this.tagGroups)?this.tagGroups.forEach(e=>{DTags.groups[e]&&(t[e]=DTags.groups[e])}):t=this.tagGroups||null,DTags.edit(this.modelValue,e=>{this.$emit("update:modelValue",e)},t)}}};jQuery(e=>{var t=document.getElementById("vx-edit-role");if(t){window.$=jQuery;let e=JSON.parse(t.dataset.config);t=Vue.createApp({el:t,data(){return{tab:"general",subtab:"general",config:e.role,available_fields:e.available_fields,supported_conditions:e.supported_conditions,condition_types:e.condition_types,active_field:null,submit_config:"",editTemplate:{active:!1,updating:!1,modifyId:!1,newId:null}}},created(){window.VX_Role_Editor=this;var e=Voxel_Backend.getSearchParam("tab");e&&(e=e.split("."),this.setTab(e[0],e[1]))},methods:{setTab(e,t=""){this.tab=e,this.subtab=t;var i=new URL(window.location);i.searchParams.set("tab",t?e+"."+t:e),window.history.replaceState(null,null,i)},prepareSubmission(){this.submit_config=JSON.stringify(this.config)},canUseField(t){return!this.config.registration.fields.find(e=>e.key===t.key)},useField(e){this.config.registration.fields.push({key:e.key,source:e.source,label:"","enable-conditions":!1,conditions:[]})},fieldProp(e,t){return this.available_fields[e]?.props[t]},deleteField(t){this.config.registration.fields=this.config.registration.fields.filter(e=>e!==t)},tagGroup(e){return DTags.groups[e]},createPricingTemplate(){jQuery.get(Voxel_Config.ajax_url,{action:"membership.create_pricing_template",role_key:this.config.settings.key}).always(e=>{e.success?this.config.settings.templates.pricing=e.template_id:Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},deletePricingTemplate(){jQuery.get(Voxel_Config.ajax_url,{action:"membership.delete_pricing_template",role_key:this.config.settings.key}).always(e=>{e.success?this.config.settings.templates.pricing=null:Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},updatePricingTemplate(){this.editTemplate.updating=!0,jQuery.get(Voxel_Config.ajax_url,{action:"membership.update_pricing_template",role_key:this.config.settings.key,template_id:this.editTemplate.newId}).always(e=>{this.editTemplate.updating=!1,e.success?(this.editTemplate.modifyId=!1,this.config.settings.templates.pricing=e.template_id):Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}}});t.component("field-key",Voxel_Backend.components.Field_Key),t.component("draggable",vuedraggable),t.component("field-modal",i),t.component("dtag-input",o),t.mount("#vx-edit-role")}})});
