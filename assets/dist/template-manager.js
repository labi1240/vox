!function(e){"function"==typeof define&&define.amd?define("templateManager",e):e()}(function(){"use strict";var s={template:"#ts-base-template-options",props:{template:Object},data(){return{modifyId:!1,newId:this.template.id,updating:!1}},methods:{saveId(){this.updating=!0,jQuery.get(Voxel_Config.ajax_url,{action:"backend.update_template_id",template_key:this.template.key,new_template_id:this.newId}).always(e=>{this.updating=!1,e.success?(this.template.id=this.newId,this.template.editSettings=!1,this.modifyId=!1):Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}}},l={template:"#ts-custom-template-options",props:{template:Object},data(){return{modifyId:!1,newId:this.template.id,updating:!1,label:this.template.label}},methods:{saveId(){this.updating=!0,jQuery.get(Voxel_Config.ajax_url,{action:"backend.update_custom_template",new_template_id:this.newId,template_label:this.label,group:this.template.group,template_id:this.template.id}).always(e=>{this.updating=!1,e.success?(this.template.id=this.newId,this.template.label=this.label,this.modifyId=!1,this.template.editLabel=!1,this.$root.config.custom_templates=e.templates):Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}}},o={template:'<span class="hide"></span>',props:{template:Object},data(){return{priority:this.priority,newId:this.template.id,updating:!1,label:this.template.label}},mounted(){this.editRules()},methods:{saveRules(){this.updating=!0,jQuery.get(Voxel_Config.ajax_url,{action:"backend.update_custom_template",new_template_id:this.newId,template_label:this.label,group:this.template.group,template_id:this.template.id,priority:this.template.priority,visibility_rules:this.template.visibility_rules}).always(e=>{this.updating=!1,e.success?(this.$root.config.custom_templates=e.templates,this.template.editRules=!1):Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},editRules(){DTags.editVisibility(this.template.visibility_rules,e=>{this.template.visibility_rules=e,this.saveRules()},()=>this.template.editRules=!1)}}},r={template:"#ts-create-custom-template",data(){return{label:"",group:this.group,updating:!1}},methods:{saveId(){this.updating=!0,this.group=this.$root.config.editTemplateType,jQuery.get(Voxel_Config.ajax_url,{action:"backend.create_custom_template",label:this.label,group:this.group}).always(e=>{this.updating=!1,e.success?(this.$root.config.custom_templates=e.templates,this.$root.config.editTemplate=!1,this.$root.config.editTemplateType=""):Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}}};jQuery(e=>{var t,a,i=document.getElementById("vx-template-manager");i&&(t=JSON.parse(i.dataset.config),a=t,(t=Vue.createApp({el:i,data(){return{config:a,tab:a.tab}},methods:{setTab(e){this.tab=e;var t=new URL(window.location);t.searchParams.set("tab",e),window.history.replaceState(null,null,t)},editLink(e){return this.config.editLink.replace("{id}",e)},previewLink(e){return this.config.previewLink.replace("{id}",e)},insertTemplate(e){this.config.editTemplate=!0,this.config.editTemplateType=e},createTemplate(e){jQuery.get(Voxel_Config.ajax_url,{action:"backend.create_template",template_key:e.key,template_type:e.type}).always(e=>{e.success?this.config.templates=e.templates:Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},deleteCustomTemplate(e,t){confirm("Are you sure you want to delete this template?")&&jQuery.get(Voxel_Config.ajax_url,{action:"backend.delete_custom_template",id:e.id,group:t}).always(e=>{e.success?this.config.custom_templates=e.templates:Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},deleteTemplate(e,t){confirm("Are you sure you want to delete this template?")&&jQuery.get(Voxel_Config.ajax_url,{action:"backend.delete_template",template_key:e.key,group:t,id:e.id}).always(e=>{e.success?this.config.templates=e.templates:Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})},dragStart(){},dragEnd(t){t.target.classList.add("vx-inert"),jQuery.post(Voxel_Config.ajax_url+"&action=backend.update_custom_template_order",{custom_templates:JSON.stringify(this.config.custom_templates)}).always(e=>{t.target.classList.remove("vx-inert"),e.success||Voxel_Backend.alert(e.message||Voxel_Config.l10n.ajaxError,"error")})}}})).component("field-key",Voxel_Backend.components.Field_Key),t.component("draggable",vuedraggable),t.component("base-template-options",s),t.component("custom-template-options",l),t.component("visibility-rules",o),t.component("create-custom-template",r),t.mount(i))})});
